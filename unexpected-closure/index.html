<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5f81339daa9828444137.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}</style><meta name="generator" content="Gatsby 2.19.7"/><title data-react-helmet="true">Unexpected Closure | Alex Figueroa</title><meta data-react-helmet="true" name="description" content="Closures in Swift are a great feature and are useful for tasks such as network callbacks, notification subscription, and providing an…"/><meta data-react-helmet="true" property="og:title" content="Unexpected Closure"/><meta data-react-helmet="true" property="og:description" content="Closures in Swift are a great feature and are useful for tasks such as network callbacks, notification subscription, and providing an…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Alex Figueroa"/><meta data-react-helmet="true" name="twitter:title" content="Unexpected Closure"/><meta data-react-helmet="true" name="twitter:description" content="Closures in Swift are a great feature and are useful for tasks such as network callbacks, notification subscription, and providing an…"/><link as="script" rel="preload" href="/webpack-runtime-4e3b8f4c404a4734a33d.js"/><link as="script" rel="preload" href="/styles-b663f38c89fc11ab71f3.js"/><link as="script" rel="preload" href="/app-ae6ed19721ef192cd71b.js"/><link as="script" rel="preload" href="/commons-212339e258227c211bc0.js"/><link as="script" rel="preload" href="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-2767f74b60a3c65bf309.js"/><link as="fetch" rel="preload" href="/page-data/unexpected-closure/page-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><div id="___gatsby"><style data-emotion-css="1poeu1w">body{--theme-ui-colors-text:var(--theme-ui-colors-text,#282c35);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#007acc);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#1B1F23);--theme-ui-colors-muted:var(--theme-ui-colors-muted,hsla(0,0%,0%,0.2));--theme-ui-colors-highlight:var(--theme-ui-colors-highlight,rgba(255,229,100,0.2));--theme-ui-colors-heading:var(--theme-ui-colors-heading,#282c35);--theme-ui-colors-prism-background:var(--theme-ui-colors-prism-background,#011627);--theme-ui-colors-prism-comment:var(--theme-ui-colors-prism-comment,#809393);--theme-ui-colors-prism-string:var(--theme-ui-colors-prism-string,#addb67);--theme-ui-colors-prism-var:var(--theme-ui-colors-prism-var,#d6deeb);--theme-ui-colors-prism-number:var(--theme-ui-colors-prism-number,#f78c6c);--theme-ui-colors-prism-constant:var(--theme-ui-colors-prism-constant,#82aaff);--theme-ui-colors-prism-punctuation:var(--theme-ui-colors-prism-punctuation,#c792ea);--theme-ui-colors-prism-className:var(--theme-ui-colors-prism-className,#ffc98b);--theme-ui-colors-prism-tag:var(--theme-ui-colors-prism-tag,#ffa7c4);--theme-ui-colors-prism-boolean:var(--theme-ui-colors-prism-boolean,#ff5874);--theme-ui-colors-prism-property:var(--theme-ui-colors-prism-property,#80cbc4);--theme-ui-colors-prism-namespace:var(--theme-ui-colors-prism-namespace,#b2ccd6);--theme-ui-colors-prism-highlight:var(--theme-ui-colors-prism-highlight,hsla(207,95%,15%,1));color:var(--theme-ui-colors-text,var(--theme-ui-colors-text,#282c35));background-color:var(--theme-ui-colors-background,var(--theme-ui-colors-background,#fff));}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,rgba(255,255,255,0.86));--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#282c35);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#007acc);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,rgba(255,255,255,0.86));--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,hsla(0,0%,100%,0.2));--theme-ui-colors-highlight:var(--theme-ui-colors-modes-dark-highlight,#007acc);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);}</style><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="16mk19i">.css-16mk19i{font-family:'Merriweather','Georgia',serif;font-size:16px;font-weight:400;line-height:1.75;}</style><div class="css-16mk19i"><header><style data-emotion-css="nvo7eq">.css-nvo7eq{max-width:672px;margin-left:auto;margin-right:auto;padding-left:28px;padding-right:28px;padding-top:56px;}</style><div class="css-nvo7eq"><style data-emotion-css="2a1trj">.css-2a1trj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:56px;}</style><div class="css-2a1trj"><style data-emotion-css="1qd1r5f">.css-1qd1r5f{margin-top:0;margin-bottom:0;}</style><style data-emotion-css="9ngr65">.css-9ngr65{padding:0;margin:0;margin-bottom:28px;font-size:23.08319849451542px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;margin-top:0;margin-bottom:0;}</style><p class="css-9ngr65"><style data-emotion-css="1febbns">.css-1febbns{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary,#007acc);}</style><style data-emotion-css="1a7e4c0">.css-1a7e4c0{color:var(--theme-ui-colors-primary,#007acc);box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary,#007acc);}</style><a class="css-1a7e4c0" href="/">Alex Figueroa</a></p><div style="position:relative;display:inline-block;text-align:left;opacity:1;direction:ltr;border-radius:12px;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s;touch-action:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none"><div class="react-switch-bg" style="height:24px;width:48px;margin:0;position:relative;background:#000000;border-radius:12px;cursor:pointer;-webkit-transition:background 0.25s;-moz-transition:background 0.25s;transition:background 0.25s"><div style="height:24px;width:25px;position:relative;opacity:0;pointer-events:none;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s"><style data-emotion-css="h5g4ul">.css-h5g4ul{margin:4px;}.css-h5g4ul function (props){-webkit-var:theme = _extends({},defaultTheme,{},props.theme || props);-moz-var:theme = _extends({},defaultTheme,{},props.theme || props);-ms-var:theme = _extends({},defaultTheme,{},props.theme || props);var:theme = _extends({},defaultTheme,{},props.theme || props);-webkit-var obj = typeof args === 'function' ? args(theme) :args;-moz-var obj = typeof args === 'function' ? args(theme) :args;-ms-var obj = typeof args === 'function' ? args(theme) :args;var obj = typeof args === 'function' ? args(theme) :args;-webkit-var:styles = responsive(obj)(theme);-moz-var:styles = responsive(obj)(theme);-ms-var:styles = responsive(obj)(theme);var:styles = responsive(obj)(theme);return:result;}.css-h5g4ul function (props) for (var key in styles){-webkit-var:x = styles[key];-moz-var:x = styles[key];-ms-var:x = styles[key];var:x = styles[key];-webkit-var val = typeof x === 'function' ? x(theme) :x;-moz-var val = typeof x === 'function' ? x(theme) :x;-ms-var val = typeof x === 'function' ? x(theme) :x;var val = typeof x === 'function' ? x(theme) :x;-webkit-var:prop = get(aliases,key,key);-moz-var:prop = get(aliases,key,key);-ms-var:prop = get(aliases,key,key);var:prop = get(aliases,key,key);-webkit-var:scaleName = get(scales,prop);-moz-var:scaleName = get(scales,prop);-ms-var:scaleName = get(scales,prop);var:scaleName = get(scales,prop);-webkit-var:scale = get(theme,scaleName,get(theme,prop,{}));-moz-var:scale = get(theme,scaleName,get(theme,prop,{}));-ms-var:scale = get(theme,scaleName,get(theme,prop,{}));var:scale = get(theme,scaleName,get(theme,prop,{}));-webkit-var:transform = get(transforms,prop,get);-moz-var:transform = get(transforms,prop,get);-ms-var:transform = get(transforms,prop,get);var:transform = get(transforms,prop,get);-webkit-var:value = transform(scale,val,val);-moz-var:value = transform(scale,val,val);-ms-var:value = transform(scale,val,val);var:value = transform(scale,val,val);}.css-h5g4ul function (props) for (var key in styles) if (key === 'variant'){-webkit-var:variant = css(get(theme,val))(theme);-moz-var:variant = css(get(theme,val))(theme);-ms-var:variant = css(get(theme,val))(theme);var:variant = css(get(theme,val))(theme);result:= _extends({},result,{},variant);continue;}if (val .css-h5g4ul function (props) for (var key in styles).css-h5g4ul function (props) for (var key in styles) typeof val === 'object'){result[key]:= css(val)(theme);continue;}.css-h5g4ul function (props) for (var key in styles) if (multiples[prop]){-webkit-var:dirs = multiples[prop];-moz-var:dirs = multiples[prop];-ms-var:dirs = multiples[prop];var:dirs = multiples[prop];}.css-h5g4ul function (props) for (var key in styles) if (multiples[prop]) for (var i = 0; i < dirs.length; i++){result[dirs[i]]:= value;}.css-h5g4ul function (props) for (var key in styles) else{result[prop]:= value;}</style><img alt="moon indicating dark mode" src="data:image/png;base64,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" width="16" height="16" role="presentation" class="css-h5g4ul"/></div><div style="height:24px;width:25px;position:absolute;opacity:1;right:0;top:0;pointer-events:none;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s"><img alt="sun indicating light mode" src="data:image/png;base64,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" width="16" height="16" role="presentation" class="css-h5g4ul"/></div></div><div class="react-switch-handle" style="height:24px;width:24px;background:#ffffff;display:inline-block;cursor:pointer;border-radius:50%;position:absolute;transform:translateX(0px);top:0;outline:0;box-shadow:inset 0 0 0 1px #000;border:0;-webkit-transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s;-moz-transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s;transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s"></div><input type="checkbox" role="switch" style="border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px" aria-label="Toggle dark mode"/></div></div></div></header><div><style data-emotion-css="1ewmu01">.css-1ewmu01{max-width:672px;margin-left:auto;margin-right:auto;padding-left:28px;padding-right:28px;padding-top:56px;padding-bottom:56px;}</style><div class="css-1ewmu01"><main><style data-emotion-css="11b9pc1">.css-11b9pc1{padding:0;margin:0;margin-bottom:28px;font-size:40px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;}</style><h1 class="css-11b9pc1">Unexpected Closure</h1><style data-emotion-css="1qqxfhy">.css-1qqxfhy{font-size:13.32085131842997px;margin-top:-28px;margin-bottom:28px;}</style><style data-emotion-css="1m60b3c">.css-1m60b3c{padding:0;margin:0;margin-bottom:28px;font-size:13.32085131842997px;margin-top:-28px;margin-bottom:28px;}.css-1m60b3c code{font-size:inherit;}</style><p class="css-1m60b3c">September 04, 2018</p><style data-emotion-css="1mv7wyt">.css-1mv7wyt{padding:0;margin:0;margin-bottom:28px;}.css-1mv7wyt code{font-size:inherit;}</style><p class="css-1mv7wyt">Closures in Swift are a great feature and are useful for tasks such as network callbacks, notification subscription, and providing an alternative to the delegate pattern.</p><p class="css-1mv7wyt">Recently, I discovered that code as inconspicuous as a <style data-emotion-css="1pnz7gf">.css-1pnz7gf{border-radius:0.3em;color:var(--theme-ui-colors-secondary,#1B1F23);background-color:var(--theme-ui-colors-highlight,rgba(255,229,100,0.2));padding-top:0.15em;padding-bottom:0.05em;padding-left:0.2em;padding-right:0.2em;}</style><code class="css-1pnz7gf">&amp;&amp;</code> (and) conditional could also leverage this feature.</p><p class="css-1mv7wyt">Let’s assume that we are modelling a <code class="css-1pnz7gf">User</code> of a global subscription-based application where users can customize their theme color.</p><p class="css-1mv7wyt">We could represent this in Swift as a struct that has properties for its: identifier, subscription status, country code, and theme color.
The resulting <code class="css-1pnz7gf">User</code> model could look like this:</p><style data-emotion-css="w0h414">.css-w0h414{padding:28px;margin:0;margin-bottom:14px;font-size:85%;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;color:white;background-color:var(--theme-ui-colors-prism-background,#011627);overflow:auto;border-radius:10px;}.css-w0h414 .attr-name{font-style:italic;}.css-w0h414 .comment{color:var(--theme-ui-colors-prism-comment,#809393);}.css-w0h414 .attr-name,.css-w0h414 .string,.css-w0h414 .url{color:var(--theme-ui-colors-prism-string,#addb67);}.css-w0h414 .variable{color:var(--theme-ui-colors-prism-var,#d6deeb);}.css-w0h414 .number{color:var(--theme-ui-colors-prism-number,#f78c6c);}.css-w0h414 .builtin,.css-w0h414 .char,.css-w0h414 .constant,.css-w0h414 .function{color:var(--theme-ui-colors-prism-constant,#82aaff);}.css-w0h414 .punctuation,.css-w0h414 .selector,.css-w0h414 .doctype{color:var(--theme-ui-colors-prism-punctuation,#c792ea);}.css-w0h414 .class-name{color:var(--theme-ui-colors-prism-className,#ffc98b);}.css-w0h414 .tag,.css-w0h414 .operator,.css-w0h414 .keyword{color:var(--theme-ui-colors-prism-tag,#ffa7c4);}.css-w0h414 .boolean{color:var(--theme-ui-colors-prism-boolean,#ff5874);}.css-w0h414 .property{color:var(--theme-ui-colors-prism-property,#80cbc4);}.css-w0h414 .namespace{color:var(--theme-ui-colors-prism-namespace,#b2ccd6);}</style><style data-emotion-css="1cd8nnu">.css-1cd8nnu{margin-bottom:14px;}</style><div class="css-1cd8nnu"><pre class="language-swift prism-code language-swift css-w0h414"><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token plain css-1baulvz">struct User {</span></div><div class="token-line"><span class="token plain css-1baulvz">    var id: String</span></div><div class="token-line"><span class="token plain css-1baulvz">    var isSubscribed: Bool</span></div><div class="token-line"><span class="token plain css-1baulvz">    var themeColor: UIColor?</span></div><div class="token-line"><span class="token plain css-1baulvz">    var countryCode: String</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">We’ll make the <code class="css-1pnz7gf">themeColor</code> optional here since it’ll be up to the User if they want to customize this.</p><p class="css-1mv7wyt">Assume that our application already had an object to represent a theme called <code class="css-1pnz7gf">Theme</code>:</p><div class="css-1cd8nnu"><pre class="language-swift prism-code language-swift css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">class Theme {</span></div><div class="token-line"><span class="token plain css-1baulvz">    let backgroundColor: UIColor</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    init(backgroundColor: UIColor?) {</span></div><div class="token-line"><span class="token plain css-1baulvz">        self.backgroundColor = backgroundColor ?? .white</span></div><div class="token-line"><span class="token plain css-1baulvz">    }</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">Observe that this <code class="css-1pnz7gf">init</code> will fallback to <code class="css-1pnz7gf">UIColor.white</code> (or <code class="css-1pnz7gf">.white</code>) if the <code class="css-1pnz7gf">backgroundColor</code> property is <style data-emotion-css="1vg6q84">.css-1vg6q84{font-weight:700;}</style><strong class="css-1vg6q84">not</strong> provided.</p><p class="css-1mv7wyt">Given this knowledge, we could create a new class just for the custom User theme.
We can initialize the custom theme with a User in order to grab its <code class="css-1pnz7gf">themeColor</code>. The theme color passes to its parent class as its <code class="css-1pnz7gf">backgroundColor</code>.</p><p class="css-1mv7wyt">A <code class="css-1pnz7gf">Theme</code> subclass can represent the custom User theme object:</p><div class="css-1cd8nnu"><pre class="language-swift prism-code language-swift css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">class UserTheme: Theme {</span></div><div class="token-line"><span class="token plain css-1baulvz">    let user: User</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    init(user: User) {</span></div><div class="token-line"><span class="token plain css-1baulvz">        self.user = user</span></div><div class="token-line"><span class="token plain css-1baulvz">        super.init(backgroundColor: user.themeColor)</span></div><div class="token-line"><span class="token plain css-1baulvz">    }</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">Let’s assume that we have received additional requirements that limit User theming to:</p><style data-emotion-css="wf0k3i">.css-wf0k3i{padding:0;margin:0;margin-bottom:28px;list-style-position:outside;list-style-image:none;margin-left:28px;}</style><ul class="css-wf0k3i"><style data-emotion-css="ikjsr2">.css-ikjsr2{margin-bottom:14px;padding-left:0;}.css-ikjsr2 ol{margin-top:14px;margin-bottom:14px;margin-left:28px;}.css-ikjsr2 ul{margin-top:14px;margin-bottom:14px;margin-left:28px;}.css-ikjsr2 p{margin-bottom:14px;}.css-ikjsr2 code{font-size:inherit;}</style><li class="css-ikjsr2">subscription users</li><li class="css-ikjsr2">Canadian users</li></ul><p class="css-1mv7wyt">We could then update our <code class="css-1pnz7gf">init</code> method on <code class="css-1pnz7gf">UserTheme</code> to handle these cases as follows:</p><div class="css-1cd8nnu"><pre class="language-swift prism-code language-swift css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">var themeColor: UIColor?</span></div><div class="token-line"><span class="token plain css-1baulvz">if self.user.isSubscribed &amp;&amp; self.user.countryCode == &quot;CA&quot; {</span></div><div class="token-line"><span class="token plain css-1baulvz">    themeColor = self.user.themeColor</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div><div class="token-line"><span class="token plain css-1baulvz">super.init(backgroundColor: themeColor)</span></div></pre></div><p class="css-1mv7wyt">Although this looks alright, it’ll actually fail to compile. You’ll see the following error log in Xcode:</p><div class="css-1cd8nnu"><pre class=" prism-code language- css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">error: &#x27;self&#x27; captured by a closure before all members were initialized</span></div><div class="token-line"><span class="token plain css-1baulvz">        if self.user.isSubscribed &amp;&amp; self.user.countryCode == &quot;CA&quot; {</span></div><div class="token-line"><span class="token plain css-1baulvz">                                     ^</span></div></pre></div><p class="css-1mv7wyt">This error message while informative is a bit confusing. What closure is it referencing?</p><p class="css-1mv7wyt">We could easily fix by removing the explicit <code class="css-1pnz7gf">self</code> and instead rely on the <code class="css-1pnz7gf">user</code> property passed in as a parameter. This fixes the symptom and not the root cause which is that there is an implicit closure in this line of code?</p><p class="css-1mv7wyt">After posting this error message to the <style data-emotion-css="o7eq5i">.css-o7eq5i{color:var(--theme-ui-colors-primary,#007acc);}</style><a href="https://www.meetup.com/tacow-org/" class="css-o7eq5i">tacow</a> Slack group, <a href="https://twitter.com/rydermackay" class="css-o7eq5i">@rydermackay</a> pointed out to me that the Swift language is capturing the right-hand side of the conditional in a closure.</p><p class="css-1mv7wyt">That is, given the conditional: <code class="css-1pnz7gf">lhs &amp;&amp; rhs</code> (“lhs” and “rhs” represent Left-Hand Side and Right-Hand Side respectively). <code class="css-1pnz7gf">rhs</code> is being wrapped in a closure. More specifically, it is wrapped in an <code class="css-1pnz7gf">autoclosure</code> so that it could lazily evaluate the right condition if the left condition was false.</p><p class="css-1mv7wyt">This can be shown by looking at the source code for the <a href="https://github.com/apple/swift/blob/7f105e4e3a994e6ac87860d5bd7bf9942c52b4bb/stdlib/public/core/Bool.swift#L289" class="css-o7eq5i">&amp;&amp; operator</a>:</p><div class="css-1cd8nnu"><pre class="language-swift prism-code language-swift css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">public static func &amp;&amp; (lhs: Bool, rhs: @autoclosure () throws -&gt; Bool) rethrows -&gt; Bool {</span></div><div class="token-line"><span class="token plain css-1baulvz">    return lhs ? try rhs() : false</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">In order to understand the warning a little better, we need to know what an <code class="css-1pnz7gf">autoclosure</code> is.</p><p class="css-1mv7wyt">From the Apple documentation, an <code class="css-1pnz7gf">autoclosure</code>:</p><style data-emotion-css="1dahk1j">.css-1dahk1j{padding:0;margin:0;margin-bottom:28px;margin-left:28px;margin-right:28px;color:inherit;border-left-color:inherit;opacity:0.8;}.css-1dahk1j.translation{font-size:1em;}</style><blockquote class="css-1dahk1j"><p class="css-1mv7wyt">…is a closure that is automatically created to wrap an expression that’s being passed as an argument to a function. It doesn’t take any arguments, and when it’s called, it returns the value of the expression that’s wrapped inside of it.</p></blockquote><p class="css-1mv7wyt">but most importantly:</p><blockquote class="css-1dahk1j"><p class="css-1mv7wyt">An autoclosure lets you delay evaluation because the code inside isn’t run until you call the closure. Delaying evaluation is useful for code that has side effects or is computationally expensive because it lets you control when that code is evaluated.</p></blockquote><p class="css-1mv7wyt">That means that the above <code class="css-1pnz7gf">&amp;&amp;</code> implementation at a high level is equivalent to the following. Note: We can’t actually write <code class="css-1pnz7gf">&amp;&amp;</code> without the <code class="css-1pnz7gf">rhs</code> since it’s defined to have both parameters.</p><div class="css-1cd8nnu"><pre class="language-swift prism-code language-swift css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">// For simplicity, I&#x27;ve removed all throws</span></div><div class="token-line"><span class="token plain css-1baulvz">public static func &amp;&amp; (lhs: Bool, rhs: () -&gt; Bool) -&gt; Bool {</span></div><div class="token-line"><span class="token plain css-1baulvz">    return lhs ?? rhs()</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div><div class="token-line"><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">// Example: Assume A and B are some boolean conditions</span></div><div class="token-line"><span class="token plain css-1baulvz">A &amp;&amp; { () -&gt; Bool in</span></div><div class="token-line"><span class="token plain css-1baulvz">    return B</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">If we update our previous <code class="css-1pnz7gf">UserTheme</code> <code class="css-1pnz7gf">init</code> with this re-interpretation, it would look like this</p><div class="css-1cd8nnu"><pre class="language-swift prism-code language-swift css-w0h414"><div class="token-line"><span class="token plain css-1baulvz">let result = self.user.isSubscribed &amp;&amp; { () -&gt; Bool in</span></div><div class="token-line"><span class="token plain css-1baulvz">    return self.user.countryCode == &quot;CA&quot;</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div><div class="token-line"><span class="token plain css-1baulvz">if result {</span></div><div class="token-line"><span class="token plain css-1baulvz">    themeColor = self.user.themeColor</span></div><div class="token-line"><span class="token plain css-1baulvz">}</span></div></pre></div><p class="css-1mv7wyt">As you can see, the block captures <code class="css-1pnz7gf">self.user.countryCode == &quot;CA&quot;</code> and since we’re doing this before <code class="css-1pnz7gf">super.init()</code> when all members have initialized the compilation fails.</p><p class="css-1mv7wyt">There are a few ways to fix this, we could:</p><ul class="css-wf0k3i"><li class="css-ikjsr2">move all this offending code to below the <code class="css-1pnz7gf">super.init()</code></li><li class="css-ikjsr2">store the result of the right-hand side expression in a separate variable, or;</li><li class="css-ikjsr2">we could move the creation of Themes to a <a href="https://en.wikipedia.org/wiki/Factory_method_pattern" class="css-o7eq5i">factory</a> class to avoid a <code class="css-1pnz7gf">Theme</code> subclass</li></ul><p class="css-1mv7wyt">Either way, these all work but in general you should typically avoid referencing <code class="css-1pnz7gf">self</code> before the <code class="css-1pnz7gf">super.init()</code> in cases like these.
I hope you learned something and potentially got you interested in looking at more implementation details of the Swift programming language.</p><p class="css-1mv7wyt">The sample code can be found <a href="https://github.com/ajfigueroa/blog-code/tree/master/posts/3-Unexpected-Closure.playground" class="css-o7eq5i">here</a>.</p><style data-emotion-css="psov1g">.css-psov1g{padding:0;margin:0;margin-bottom:28px;font-size:27.725793726205858px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;}</style><style data-emotion-css="1ieeh81">.css-1ieeh81{pointer-events:painted;padding:0;margin:0;margin-bottom:28px;font-size:27.725793726205858px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;}.css-1ieeh81 a{visibility:hidden;}.css-1ieeh81:hover a{visibility:visible;}</style><h2 id="additional-resources" class="css-1ieeh81"><style data-emotion-css="vvm4x1">.css-vvm4x1{margin-left:-20px;padding-right:4px;color:var(--theme-ui-colors-primary,#007acc);}</style><a href="#additional-resources" class="css-vvm4x1"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Additional Resources</h2><ul class="css-wf0k3i"><li class="css-ikjsr2"><a href="https://docs.swift.org/swift-book/LanguageGuide/Closures.html#ID543" class="css-o7eq5i">Autoclosure Documentation</a></li><li class="css-ikjsr2"><a href="https://krakendev.io/blog/hipster-swift#autoclosure" class="css-o7eq5i">Hipster Swift post by KrakenDev</a></li><li class="css-ikjsr2"><a href="https://github.com/apple/swift" class="css-o7eq5i">Swift Repo</a></li></ul></main><style data-emotion-css="47xi18">.css-47xi18{margin-top:56px;padding-top:28px;}</style><footer class="css-47xi18"><style data-emotion-css="5rlcw3">.css-5rlcw3{padding:0;margin:0;margin-bottom:28px;border:0;border-bottom:1px solid;margin-top:-1px;border-color:var(--theme-ui-colors-muted,hsla(0,0%,0%,0.2));}</style><hr class="css-5rlcw3"/><style data-emotion-css="1hx7the">.css-1hx7the{margin-bottom:56px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="1kt7aet">.css-1kt7aet{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:56px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion-css="xcwvoj">.css-xcwvoj{box-sizing:border-box;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:56px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-xcwvoj"><style data-emotion-css="14437zr">.css-14437zr{margin-right:14px;margin-bottom:0;width:48px;min-width:48px;border-radius:99999px;}</style><div class="css-14437zr gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:48px;height:48px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAEv0lEQVQ4yw3Nb1CSdwDA8WevqssskUThRCTkP2igIAGipgYioALy8P8//OB5eJ6HPwoIppFNsZCmi6WV52p1l3m31lZrW61112537UXX3my329Zu3W7bm2570+v59vt98YHKlbXZM+UwlvUCwg9wbwQJAjQEUH8ERBA0HMcDESIQRQIxPIziPkD44hlA5JFUkcgWoeKZpVyx5AOYN4o4fMDhi7lCiCsIgiDujUQzudmNzWuuUNgfBf5oPIal0GQ6jmfQVDqdT0PpQgZg2N4DeCJdTCVze07E7nfZvc4x06ROa/DA8KR5yu7dK65kFk9mCSSZiCRiESQGmeEpp8+dnU1m8igyHXSHYJN1Uqcfk8uUIoG0hcqA3tl/6BBpeOSUM2AvLCGnl7GZ+QQxgxYXMhDstMEem8U+aTKbzDaTKwQbxg1ikZTJ4jeSaVIOx6I5QaU0NzfTPX4LNhOqbuZXN7LJfKRSy0MxJFhYwFK5OECD/rAtXYxY7EbKUSo8rLleSDy/fObfB5trhL/+MMU4MTgzHyitYKUVfPF8urSUhqZcplHTSO5ssFwDvrDeF9DpDINZt+WPj9ffPrnxz73aw2rh8gxgMVnqEalhSg0Ie6k8XbqQXShn9uQpp8sMgMXhPGkYl1vscoWaj8ETpbh/zm1aClmDBq3fqJOJRd0KkUQpVA5Jk6cdq1exSx8SkNM9sLSMZXJ+69SIzanUm8Ueq+L9VPjOAvrpIvHwfOFmFnyyPLOK+DTqLr6EzRaxw9jYR7uZ67enIWm30OvTTzlOdvXwFBper4prGpK/2ll9vVv96erid+ulByX8t1uV7Vkg7eV1CBn0Y4yT2p7NrejmVhziCth9A0KpjCMQH5MrOBJVx3E59/672K83zj5dyW7HPRuI57MSwNza3j6xVqcwjKtAXL/+HqitJSCpgqUa5ElkrM7u9g4RfVwkuKMafjpmfnaReLFaeIQnthH3jax32jFcXvRduYTXKsjF85FqOV7EYIjNp7WzaO0dtHZO85JE/kbneHsK3lGrH68gL68Uvqlkdhcii+7RCq/7+tDQyllvYd6bTZkJ1IAGddApfTdsV/lCA1v9ff8N295ord+LVes69Y9b0zfTjpLHgI4q5xwjQCTeYcnu2eELVaJwLhCLjfp8/VBp3lmYg3MZ888m29+DE7/3m15KNG4m68sK+vU5f2FcUZzUXIxZlPS2GlO4LTixLRtYj7qIggN2qiEvGAwltJ9bza/7x//UjP3Vb/yldxClMHSa3hdb88+q+KMLeMymP3aYfK2Nkxf3lYXK571a3KYzGZVQesa0FjW/6p/4qkt5iye5Ley5K+jZFXa3HWxgs9nmoT5lV+eBenIHibLF4Gq5UgdL8JArXz/RNx2fhOZStntG8w/yoR2uBJBoZNLRtibqJTrP0dQK7avbt/9wXV1jfUMT5yj1Jud4G4kiJrVsM0QbAll1DoYqWe9TrfGJWHmf141QGLRWZiebn2fw5qmsA3VHmhopLRQaidzCotC+EMv0VGbLIdIanbfB7NwIW6Ea7vlWpb0rkG218z0Nza0U2jXO8YV2/rlWNvngkYN1DWQSpZHcQqfQHnfJTdR2dj15o433AV10ZVT7PwvQsCK0UqZlAAAAAElFTkSuQmCC" alt="Alex Figueroa" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/57807e4e1b6cbb33b0d83d19b713f093/aff39/avatar.png 1x,
/static/57807e4e1b6cbb33b0d83d19b713f093/e5b88/avatar.png 1.5x,
/static/57807e4e1b6cbb33b0d83d19b713f093/88b72/avatar.png 2x" /><img loading="lazy" width="48" height="48" srcset="/static/57807e4e1b6cbb33b0d83d19b713f093/aff39/avatar.png 1x,
/static/57807e4e1b6cbb33b0d83d19b713f093/e5b88/avatar.png 1.5x,
/static/57807e4e1b6cbb33b0d83d19b713f093/88b72/avatar.png 2x" src="/static/57807e4e1b6cbb33b0d83d19b713f093/aff39/avatar.png" alt="Alex Figueroa" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="css-0">Personal blog where I sometimes talk about iOS</div></div></footer></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/unexpected-closure/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ae6ed19721ef192cd71b.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-2767f74b60a3c65bf309.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js-32fc1fc34e9f2d2c4f50.js"]};/*]]>*/</script><script src="/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-2767f74b60a3c65bf309.js" async=""></script><script src="/commons-212339e258227c211bc0.js" async=""></script><script src="/app-ae6ed19721ef192cd71b.js" async=""></script><script src="/styles-b663f38c89fc11ab71f3.js" async=""></script><script src="/webpack-runtime-4e3b8f4c404a4734a33d.js" async=""></script></body></html>